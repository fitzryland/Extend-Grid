$darkPurple: #655795;
$purple: #9f90ff;
$lightPurple: #d3cbff;

@mixin group() {
	&:after {
		content: "";
		display: table;
		clear: both;
	}
}

//
// This is the bread and butter
//

// (name, breakpoint-min-width, breakpoint-max-width, max-width, gutter, columns)
$layouts:
	(small, 0px, 600px, 100%, 4, 2)
	(medium, 601px, 959px, 100%, 3, 4)
	(medium-andup, 601px, 99999px, 100%, 3, 4) // really not ideal way to add a media query
	(large, 960px, 99999px, 1200px, 2, 6);

// add a media query for each layout
@mixin break($media) {
	@each $layout in $layouts {
		@if nth($layout, 1) == $media {
			@media all and
				(min-width: nth($layout, 2)) and
				(max-width: nth($layout, 3))
				{ @content; }
		}
	}
}

// when the cols have to be relative to the container
@mixin cols($layout-name, $cols, $parent-cols) {
	@each $layout in $layouts {
		@if nth($layout, 1) == $layout-name {
			$columns: nth($layout, 6);
			$local-width: 1;
			@if not $parent-cols == '' {
				$local-width: $parent-cols/$columns;
			}
			$gutter: nth($layout, 5) * $local-width / 100;
			@include break($layout-name) {
				margin-right: percentage($gutter);
				width: percentage(((($local-width + $gutter) / $columns) * $cols) - $gutter);
			}
		}
	}
}
@mixin layoutWrap($layout) {
	@include break($layout) {
		max-width: nth($layout, 4);
	}
}

// Extendable Flexible Grid
// an extendable aproach would work if each col was
// not relative to its container.
@each $layout in $layouts {
	$layout-name: nth($layout, 1);
	$min-width: nth($layout, 2);
	$max-width: nth($layout, 3);
	$width: nth($layout, 4);
	$gutter: percentage(nth($layout, 5)/100);
	$columns: nth($layout, 6);
	@media all and (max-width: $max-width) and (min-width: $min-width) {
		@for $ii from 1 through $columns {
			%#{$layout-name}-cols-#{$ii} {
				width: ($ii * ((100% + $gutter) / $columns)) - $gutter;
				margin-right: $gutter;
			}
		}
		%#{$layout-name}-wrap {
			max-width: $width;
		}
		%#{$layout-name}-rowstart {
			clear: both;
		}
		%#{$layout-name}-rowend {
			margin-right: 0;
		}
	}
}

* {
	box-sizing: border-box;
}
html {
	background-color: $darkPurple;
}

section {
	@extend %small-wrap;
	@extend %medium-wrap;
	@extend %large-wrap;
	background-color: $purple;
	margin: 2em auto 0;
	@include group();
}
h1 {
	margin: 0;
}
%block {
	border: 1px solid $darkPurple;
	background-color: $lightPurple;
	float: left;
	min-height: 100px;
	margin-top: 1em;
	padding: 1em;
}
.block1, .block2, .block3, .block4, .block5, .block6, .block7 {
	@extend %block;
}
.block1 {
	@extend %small-cols-1;
	@extend %medium-cols-1;
	@extend %large-cols-2;
	@include break(small) {
		background-color: red;
	}
	@include break(medium) {
		background-color: orange;
	}
	@include break(medium-andup) {
		height: 20em;
	}
	@include break(large) {
		background-color: yellow;
	}
}
.block2 {
	@extend %small-cols-1, %small-rowend;
	@extend %medium-cols-1;
	@extend %large-cols-2;
}
.block3 {
	@extend %small-cols-2, %small-rowend;
	@extend %medium-cols-2, %medium-rowend;
	@extend %large-cols-1;
	@include break(medium) {
		height: 20em;
	}
}
.block4 {
	@extend %small-cols-1;
	@extend %medium-cols-3, %medium-rowstart;
	@extend %large-cols-1, %large-rowend;
}
.block5 {
	@extend %small-cols-1, %small-rowend;
	@extend %medium-cols-1, %medium-rowend;
	@extend %large-cols-3;
}
.block6 {
	@extend %small-cols-2;
	@extend %medium-cols-2, %medium-rowstart;
	@extend %large-cols-1;
}
.block7 {
	@extend %small-cols-1;
	@extend %medium-cols-2, %medium-rowend;
	@extend %large-cols-2, %large-rowend;
}
.block {
}
.block-1, .block-2, .block-3, .block-4, .block-5, .block-6, .block-7 {
}
.block-1 {
	background-color: #BAD555;
	@include group();
	@include cols(small, 2, '');
	@include cols(medium, 3, '');
	@include cols(large, 4, '');
}
.block-1-1 {
	@extend %block;
	@include cols(small, 1, 2);
	@include cols(medium, 1, 3);
	@include cols(large, 1, 4);
}
.block-1-2 {
	@extend %block;
	@include cols(small, 1, 2);
	@include cols(medium, 2, 3);
	@include cols(large, 1, 4);
	.block-1 & {
		margin-right: 0;
	}
}
.block-2 {
	@extend %block;
	@include cols(small, 1, '');
	@include cols(medium, 1, '');
	@include break(medium) {
		margin-right: 0;
	}
	@include cols(large, 1, '');
}
.block-3 {
	@extend %block;
	@include cols(small, 1, '');
	@include break(small) {
		margin-right: 0;
	}
	@include cols(medium, 1, '');
	@include cols(large, 1, '');
}
.block-4 {
	@extend %block;
	@extend %medium-rowend;
	@include cols(small, 2, '');
	@include cols(medium, 4, '');
	@include cols(large, 4, '');

}
.block-5 {
	@extend %block;
	@include break(small) {
		margin-right: 0;
	}
	@include cols(small, 2, '');
	@include cols(medium, 3, '');
	@include cols(large, 4, '');
}
.block-6 {
	@extend %block;
	@include cols(small, 2, '');
	@include cols(medium, 3, '');
	@include cols(large, 4, '');
}
.block-7 {
	@extend %block;
	@include cols(small, 2, '');
	@include break(small) {
		margin-right: 0;
	}
	@include cols(medium, 3, '');
	@include cols(large, 4, '');
}